<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Password Protect - EDITSMYPDF</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/styles.css" />
  <link rel="canonical" href="https://editmypdf.tech/features/protect.html" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
    <style>
      /* Align fields like Compress page: stacked, centered, minimal spacing */
  .protect-card { max-width: 760px; margin: 0 auto; padding: 2.5rem; }
  .protect-card .upload-box { margin-top: .6rem; margin-bottom: 1.4rem; min-height:160px; display:flex; align-items:center; justify-content:center; font-size:1.05rem; }
      .field { max-width: 520px; margin: 1.1rem auto 0; text-align: left; }
      .field label { display:block; margin:.25rem 0 .45rem; color:#444; font-weight:600; }
      .field input { width: 100%; }
      .actions { display:flex; justify-content:center; gap:.9rem; flex-wrap:wrap; margin-top:1.25rem; }
      .progress { margin-top: 1rem; }
  .file-info { margin-top: .5rem; color:#333; font-weight:500; font-size:.95rem; min-height:1.1rem; }
      /* Scoped blog styles: Protect guide */
      .protect-guide{max-width:900px;margin:2rem auto 0;padding:0 .5rem}
      .protect-guide .eyebrow{display:inline-block;padding:.25rem .6rem;border-radius:999px;border:1px solid #e9ecf3;background:linear-gradient(90deg,#fff,#f7f8ff);font-size:.85rem;color:#333}
      .protect-guide h2{font-size:1.75rem;line-height:1.25;margin:.65rem 0 .45rem}
      .protect-guide .sub{color:#60636c;margin:0 0 1rem}
      .protect-guide .meta{font-size:.92rem;color:#777;margin-bottom:1.2rem}
      .protect-guide .hero{display:grid;gap:1rem;grid-template-columns:1.15fr .85fr;align-items:center;border:1px solid #e9ecf3;border-radius:20px;padding:1.1rem;background:#fff;box-shadow:0 8px 24px rgba(0,0,0,.05)}
      .protect-guide .cta{display:inline-flex;align-items:center;gap:.55rem;font-weight:700;background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:#fff;padding:.8rem 1.05rem;border-radius:12px;text-decoration:none;box-shadow:0 6px 16px rgba(37,99,235,.25)}
      .protect-guide .viz{width:100%;height:auto;border:1px solid #e9ecf3;border-radius:16px;overflow:hidden}
      .protect-guide article{margin-top:2rem}
      .protect-guide h3{font-size:1.25rem;margin:1.4rem 0 .5rem}
      .protect-guide p{margin:0 0 1rem}
      .protect-guide .grid{display:grid;gap:1rem}
      @media (min-width:800px){ .protect-guide .grid{grid-template-columns:1fr 1fr} }
      .protect-guide .card{border:1px solid #e9ecf3;border-radius:16px;padding:1rem;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.04)}
      .protect-guide figure{margin:0}
      .protect-guide figcaption{font-size:.85rem;color:#666;margin-top:.5rem}
      .protect-guide .tip{background:#f8faff;border-left:4px solid var(--accent);border-radius:10px;padding:1rem;margin:.9rem 0}
      .protect-guide .faq details{border:1px solid #e9ecf3;border-radius:12px;padding:.75rem 1rem;background:#fff}
      .protect-guide .faq details+details{margin-top:.75rem}
      .protect-guide .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;background:#f5f7fb;border:1px solid #e7ebf3;padding:.15rem .35rem;border-radius:6px;font-size:.9rem}
    </style>
  </head>
  <body>
    <header data-include="navbar"></header>
    <div id="ad-top" class="ad-slot"></div>

  <main class="feature">
      <h2>Password Protect</h2>
      <p class="sub">
        Secure your PDF with a password (processing happens entirely in your
        browser). Do not use this tool for illegal or infringing content.
      </p>

  <div class="card feature-enter protect-card">
        <label class="upload-box" id="drop-zone">
          üìÑ Drop your PDF here or click to upload
          <input
            type="file"
            id="file-input"
            accept="application/pdf"
            style="display: none"
          />
        </label>
        <div id="file-info" class="file-info"></div>

        <div class="field">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Enter password" />
        </div>
        <div class="field">
          <label for="confirm">Confirm Password</label>
          <input type="password" id="confirm" placeholder="Confirm password" />
        </div>
        <div class="field">
          <label for="output-name">Output filename</label>
          <input
            type="text"
            id="output-name"
            placeholder="e.g., protected"
            value="protected"
          />
        </div>

        <div class="actions">
          <button id="protect-btn" class="primary" disabled>Protect PDF</button>
        </div>
        <div id="status" class="progress"></div>
        <div class="actions">
          <button id="download-btn" class="primary" style="display: none">Download Protected PDF</button>
        </div>
      </div>

  <div id="ad-content" class="ad-slot"></div>
      <!-- Inline feature blog: Password Protect (replaced with detailed guide) -->
      <section class="feature-blog protect-guide" aria-labelledby="protect-guide-title">
        <span class="eyebrow">Behind the Scenes</span>
        <h2 id="protect-guide-title">Lock Your PDF with a Password ‚Äî Simple, Fast &amp; Private</h2>
        <p class="sub">Sharing a proposal, marksheet, ID scan, or invoice? Add a password so only the right people can open it. This guide explains how our Password Protect tool works in your browser and how to choose a strong passphrase.</p>
        <p class="meta">Runs fully on your device ‚Ä¢ No uploads ‚Ä¢ Good for sensitive docs and quick sharing</p>

        <div class="hero">
          <div>
            <p>
              Our Password Protect tool creates a new, locked copy of your PDF. You pick a password, we encrypt the file locally, and you download the protected version. Your original remains unchanged, and nothing leaves your computer. It‚Äôs a quick privacy boost for everyday documents.
            </p>
            <a class="cta" href="/features/protect.html" aria-label="Open the Password Protect tool">üîí Protect a PDF</a>
            <p style="margin:.6rem 0 0">Use a passphrase like <span class="kbd">river-sky-7!caps</span> ‚Äî long, memorable, and hard to guess.</p>
          </div>

          <figure class="viz" role="img" aria-label="Password protection pipeline diagram">
            <img alt="PDF password protection flow"
                 src="data:image/svg+xml;utf8,
                 <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 940 320'>
                   <defs><linearGradient id='g' x1='0' x2='1'>
                     <stop offset='0%' stop-color='%236366f1'/><stop offset='100%' stop-color='%232563eb'/></linearGradient></defs>
                   <rect x='30' y='60' width='230' height='200' rx='16' fill='#fff' stroke='%23dbe1ff'/>
                   <text x='145' y='95' text-anchor='middle' font-family='Inter,Arial' font-size='15' fill='%23333'>Your PDF</text>
                   <rect x='60' y='120' width='170' height='120' rx='10' fill='#eef2ff' stroke='%23dbe1ff'/>
                   <rect x='330' y='60' width='280' height='70' rx='12' fill='#eaf9ff' stroke='%23cfeaff'/>
                   <text x='470' y='100' text-anchor='middle' font-family='Inter,Arial' font-size='14' fill='%23333'>Choose password &amp; options</text>
                   <rect x='330' y='150' width='280' height='70' rx='12' fill='#f7f8ff' stroke='%23e6e9ff'/>
                   <text x='470' y='190' text-anchor='middle' font-family='Inter,Arial' font-size='14' fill='%23333'>Encrypt &amp; rebuild locally</text>
                   <rect x='650' y='60' width='260' height='200' rx='16' fill='#fff' stroke='%23dbe1ff'/>
                   <text x='780' y='95' text-anchor='middle' font-family='Inter,Arial' font-size='15' fill='%23333'>Locked PDF</text>
                   <rect x='690' y='120' width='180' height='120' rx='12' fill='#dcfce7' stroke='%23bbf7d0'/>
                   <path d='M260 160 L330 95' stroke='url(%23g)' stroke-width='6'/>
                   <path d='M260 160 L330 185' stroke='url(%23g)' stroke-width='6'/>
                   <path d='M610 95 L650 160' stroke='url(%23g)' stroke-width='6'/>
                   <path d='M610 185 L650 160' stroke='url(%23g)' stroke-width='6'/>
                 </svg>"/>
            <figcaption>Pick a password ‚Üí we encrypt a new copy on your device ‚Üí you download the locked PDF.</figcaption>
          </figure>
        </div>

        <article>
          <h3>How it works (in plain English)</h3>
          <p>
            A PDF is like a sealed folder of pages. When you protect it, we make a new copy of that folder and attach an <em>unlock rule</em>: ‚Äúask for this password before opening.‚Äù The encryption scrambles the file‚Äôs contents so a viewer app can‚Äôt read it until the right password is supplied. Once you enter it, the viewer decrypts the pages in memory and shows them normally.
          </p>
          <p>
            Everything happens inside your browser tab. There‚Äôs no upload, processing queue, or server storage. Close the tab, and the temporary working data goes away with it.
          </p>

          <div class="grid">
            <div class="card">
              <h3 style="margin:.2rem 0 .4rem">Great use cases</h3>
              <ul style="margin:.2rem 0 0 1rem">
                <li>Sending invoices, marksheets, or offer letters by email</li>
                <li>Sharing report drafts with a limited group</li>
                <li>Storing ID scans or medical slips in personal archives</li>
                <li>Handing in coursework that requires privacy</li>
              </ul>
            </div>
            <div class="card">
              <figure>
                <img alt="Before and after protection illustration"
                     src="data:image/svg+xml;utf8,
                     <svg xmlns='http://www.w3.org/2000/svg' width='1200' height='620'>
                       <rect width='1200' height='620' fill='%23ffffff'/>
                       <text x='300' y='90' text-anchor='middle' font-size='22' fill='%23333'>Unprotected</text>
                       <rect x='120' y='120' width='380' height='420' rx='12' fill='%23fff' stroke='%23e1e5ff'/>
                       <rect x='160' y='470' width='300' height='16' rx='8' fill='%23111' opacity='.08'/>
                       <text x='900' y='90' text-anchor='middle' font-size='22' fill='%23333'>Protected</text>
                       <rect x='720' y='120' width='380' height='420' rx='12' fill='%23fff' stroke='%23e1e5ff'/>
                       <rect x='840' y='300' width='120' height='120' rx='20' fill='%23dcfce7' stroke='%23bbf7d0'/>
                       <circle cx='900' cy='330' r='36' fill='none' stroke='%23065f46' stroke-width='10'/>
                       <rect x='885' y='343' width='30' height='25' rx='4' fill='%23065f46'/>
                     </svg>"/>
                <figcaption>Left: a normal PDF. Right: a locked copy that prompts for a password before opening.</figcaption>
              </figure>
            </div>
          </div>

          <h3>Step-by-step: from open file to locked PDF</h3>
          <ol>
            <li><strong>Open the tool:</strong> go to <span class="kbd">/features/protect.html</span>.</li>
            <li><strong>Add your PDF:</strong> drag &amp; drop or click to choose a file.</li>
            <li><strong>Set a password:</strong> use at least 10 characters, with words + numbers + a symbol.</li>
            <li><strong>Protect:</strong> click <em>Protect PDF</em> to build the encrypted copy locally.</li>
            <li><strong>Download &amp; test:</strong> save it (e.g., <span class="kbd">offer-letter-protected.pdf</span>) and reopen to confirm the prompt.</li>
          </ol>

          <div class="tip">
            <strong>Strong password recipe:</strong> pick <em>three random words</em> + <em>a number</em> + <em>a symbol</em> (e.g., <span class="kbd">violet-train-lake-47!</span>). Avoid names, birthdays, or common words like ‚Äúpassword123‚Äù.
          </div>

          <h3>What password protection is (and isn‚Äôt)</h3>
          <p>
            Password protection is a smart first layer: it prevents casual access and keeps shared files private. But it isn‚Äôt a silver bullet. If the password is weak or reused, determined attackers could guess it. Also, some viewers ignore ‚Äúno copy/print‚Äù flags ‚Äî those are advisory, not strict DRM. Your best defense is a <strong>strong, unique password</strong> and sharing it <strong>securely</strong>.
          </p>

          <h3>Safe sharing basics</h3>
          <ul>
            <li>Send the PDF and the password via <em>different channels</em> (email + message).</li>
            <li>Rotate the password if the file is reused across terms or clients.</li>
            <li>Keep an unprotected original in a private archive for future edits.</li>
          </ul>

          <h3>FAQs</h3>
          <div class="faq">
            <details>
              <summary>Does this change my original file?</summary>
              <p>No. We create a new locked copy. Your original remains untouched.</p>
            </details>
            <details>
              <summary>Will everyone be asked for the password?</summary>
              <p>Yes. Any standard PDF reader will prompt for the password before opening.</p>
            </details>
            <details>
              <summary>Can I remove the password later?</summary>
              <p>Yes. Open with the password, export an unlocked copy, or use our tools to rebuild without protection.</p>
            </details>
          </div>

          <p class="sub" style="margin-top:1rem">Ready to lock it down? Pick a strong passphrase, protect your file locally, and share with confidence.</p>
          <p><a class="cta" href="/features/protect.html">Open Password Protect</a></p>
        </article>
      </section>
    </main>
    <div id="ad-footer" class="ad-slot"></div>
    <div data-include="footer"></div>

    <script>
      const pdfjsLib = window["pdfjs-dist/build/pdf"];
      if (pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
      }

      // Basic runtime checks for required libraries
      function libsReady() {
        const ok = typeof PDFDocument !== "undefined";
        if (!ok) {
          console.error("Libraries not loaded", {
            PDFDocument: typeof PDFDocument,
          });
        }
        return ok;
      }

      // Dynamic loader with multi-CDN fallbacks for PDFKit and blob-stream
      function loadScript(url) {
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = url;
          s.async = true;
          s.crossOrigin = "anonymous";
          s.onload = () => resolve();
          s.onerror = () => reject(new Error("Failed to load " + url));
          document.head.appendChild(s);
        });
      }

      async function ensureEncryptionLibsLoaded() {
        if (libsReady()) return true;
        // Try local vendored copies first
        const localPdfkit = [
          "../vendor/pdfkit.standalone.min.js",
          "../vendor/pdfkit.standalone.js",
        ];
        for (const u of localPdfkit) {
          try {
            await loadScript(u);
            if (typeof PDFDocument !== "undefined") return true;
          } catch (e) {
            /* ignore */
          }
        }
        // Fall back to multiple CDNs
        const pdfkitUrls = [
          "https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.min.js",
          "https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.js",
          "https://unpkg.com/pdfkit@0.13.0/js/pdfkit.standalone.js",
        ];
        for (const u of pdfkitUrls) {
          try {
            await loadScript(u);
            if (typeof PDFDocument !== "undefined") return true;
          } catch (e) {
            console.warn(e.message);
          }
        }
        return libsReady();
      }

      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const fileInfo = document.getElementById("file-info");
      const protectBtn = document.getElementById("protect-btn");
      const statusText = document.getElementById("status");
      const downloadBtn = document.getElementById("download-btn");
      const passwordInput = document.getElementById("password");
      const confirmInput = document.getElementById("confirm");

      let srcBytes = null;
      let outBlob = null;

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });
      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("dragover")
      );
      dropZone.addEventListener("drop", async (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        const f = e.dataTransfer.files[0];
        if (f) await loadFile(f);
      });
      fileInput.addEventListener("click", (e) => e.stopPropagation());
      fileInput.addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (f) await loadFile(f);
        e.target.value = "";
      });

      async function loadFile(f) {
        const sizeMB = (f.size / (1024 * 1024)).toFixed(2);
        fileInfo.textContent = `üìÑ ${f.name} (${sizeMB} MB uploaded)`;
        const buf = await f.arrayBuffer();
        srcBytes = new Uint8Array(buf);
        protectBtn.disabled = false;
        statusText.textContent = "";
        downloadBtn.style.display = "none";
      }

      function getOutputName(defaultBase) {
        const el = document.getElementById("output-name");
        let name =
          (el && el.value ? el.value : "").trim() || defaultBase || "output";
        name = name.replace(/[\\/:*?"<>|]/g, "-");
        if (!/\.pdf$/i.test(name)) name += ".pdf";
        return name;
      }

      async function renderToImages(bytes) {
        // Render PDF to array of canvases (images)
        const pdf = await pdfjsLib.getDocument({ data: bytes }).promise;
        const pages = [];
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: 2.0 }); // higher quality
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = Math.floor(viewport.width);
          canvas.height = Math.floor(viewport.height);
          await page.render({ canvasContext: ctx, viewport }).promise;
          pages.push({ canvas, width: canvas.width, height: canvas.height });
        }
        return pages;
      }

      function pxToPt(px) {
        // Assume 96 CSS dpi -> 72pt per inch
        return (px * 72) / 96;
      }

      function buildEncryptedPDF(pages, password) {
        return new Promise((resolve, reject) => {
          try {
            if (!libsReady()) {
              return reject(
                new Error(
                  "PDFKit failed to load. Check network, CSP, or add vendor/pdfkit.standalone.js"
                )
              );
            }
            // Use different owner password to avoid viewers treating it as owner-only perms
            const doc = new PDFDocument({
              autoFirstPage: false,
              userPassword: password,
              ownerPassword: password + "-owner",
              permissions: {
                printing: "highResolution",
                copying: false,
                modifying: false,
              },
            });

            // Collect chunks directly without blob-stream
            const chunks = [];
            doc.on("data", (chunk) => chunks.push(chunk));
            doc.on("error", (e) => reject(e));
            doc.on("end", () => {
              try {
                const blob = new Blob(chunks, { type: "application/pdf" });
                resolve(blob);
              } catch (e) {
                reject(e);
              }
            });

            (async () => {
              for (const pg of pages) {
                // Convert canvas to a JPEG data URL string for browser PDFKit
                const dataUrl = pg.canvas.toDataURL("image/jpeg", 0.9);
                const pageW = pxToPt(pg.width);
                const pageH = pxToPt(pg.height);
                doc.addPage({ size: [pageW, pageH], margin: 0 });
                doc.image(dataUrl, 0, 0, { width: pageW, height: pageH });
              }
              doc.end();
            })();
          } catch (e) {
            reject(e);
          }
        });
      }

      async function verifyEncrypted(blob) {
        try {
          const ab = await blob.arrayBuffer();
          // Decode as ISO-8859-1 to preserve bytes -> string mapping for /Encrypt marker search
          const str = new TextDecoder("iso-8859-1").decode(new Uint8Array(ab));
          // Look for /Encrypt in trailer or xref streams
          return str.indexOf("/Encrypt") !== -1 || str.indexOf("/O ") !== -1;
        } catch {
          return false;
        }
      }

      protectBtn.addEventListener("click", async () => {
        const pwd = (passwordInput.value || "").trim();
        const conf = (confirmInput.value || "").trim();
        if (!pwd) {
          statusText.textContent = "Please enter a password.";
          return;
        }
        if (pwd !== conf) {
          statusText.textContent = "Passwords do not match.";
          return;
        }
        if (!srcBytes) {
          statusText.textContent = "Please upload a PDF first.";
          return;
        }
        protectBtn.disabled = true;
        statusText.textContent = "Loading encryption engine...";
        try {
          const ready = await ensureEncryptionLibsLoaded();
          if (!ready)
            throw new Error(
              "PDFKit or blob-stream failed to load. Check network or CSP."
            );
          statusText.textContent = "Rendering pages...";
          const pages = await renderToImages(srcBytes);
          statusText.textContent = "Encrypting and rebuilding PDF (PDFKit)...";
          outBlob = await buildEncryptedPDF(pages, pwd);
          // Verify encryption flag exists; if not, treat as failure
          const ok = await verifyEncrypted(outBlob);
          if (!ok) {
            throw new Error(
              "Encryption flag missing in output PDF. Your browser environment may not support client-side PDF encryption."
            );
          }
          downloadBtn.style.display = "inline-block";
          statusText.textContent = "Protected PDF is ready.";
        } catch (e) {
          console.error("Protect failed:", e);
          statusText.textContent = `Failed to protect PDF${
            e && e.message ? ": " + e.message : "."
          }`;
        } finally {
          protectBtn.disabled = false;
        }
      });

      downloadBtn.addEventListener("click", () => {
        if (!outBlob) return;
        const url = URL.createObjectURL(outBlob);
        const a = document.createElement("a");
        a.href = url;
        a.download = getOutputName("protected");
        a.click();
        URL.revokeObjectURL(url);
      });
    </script>
    <script src="../assets/app.js"></script>
  </body>
</html>
