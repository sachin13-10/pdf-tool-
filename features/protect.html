<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Password protect PDF files for free. Add user and owner passwords with encryption  browser-based security tool, no uploads required."
    />
    <title>Password Protect - EDITSMYPDF</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/styles.css" />
    <link rel="canonical" href="https://editmypdf.tech/features/protect.html" />
    <link rel="icon" type="image/png" href="../assets/images/sflogoPNG.PNG" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
    <style>
      * {
        box-sizing: border-box;
      }

      /* Align fields like Compress page: stacked, centered, minimal spacing */
      .protect-card {
        max-width: 760px;
        margin: 0 auto;
        padding: 2.5rem;
      }
      .protect-card .upload-box {
        margin-top: 0.6rem;
        margin-bottom: 1.4rem;
        min-height: 160px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.05rem;
      }
      .field {
        max-width: 520px;
        margin: 1.1rem auto 0;
        text-align: left;
      }
      .field label {
        display: block;
        margin: 0.25rem 0 0.45rem;
        color: #444;
        font-weight: 600;
      }
      .field input {
        width: 100%;
      }
      .actions {
        display: flex;
        justify-content: center;
        gap: 0.9rem;
        flex-wrap: wrap;
        margin-top: 1.25rem;
      }
      .progress {
        margin-top: 1rem;
      }
      .file-info {
        margin-top: 0.5rem;
        color: #333;
        font-weight: 500;
        font-size: 0.95rem;
        min-height: 1.1rem;
      }

      /* Enhanced Feature Blog Styles */
      .feature-blog {
        max-width: 700px;
        margin: 3rem auto;
        padding: 2rem;
        background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
        border-left: 5px solid #2563eb;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(37, 99, 235, 0.08);
        line-height: 1.7;
      }
      .feature-blog h3 {
        font-size: 2rem;
        color: #1e40af;
        margin-bottom: 1rem;
        font-weight: 700;
        line-height: 1.3;
      }
      .feature-blog h4 {
        font-size: 1.5rem;
        color: #1e40af;
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: 600;
      }
      .feature-blog p {
        color: #475569;
        margin-bottom: 1rem;
      }
      .feature-blog strong {
        color: #1e40af;
        font-weight: 600;
      }
      .feature-blog code {
        background: #e0e7ff;
        color: #3730a3;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
      }
      .feature-blog ul,
      .feature-blog ol {
        margin: 1rem 0 1.5rem 1.5rem;
        color: #475569;
      }
      .feature-blog li {
        margin-bottom: 0.75rem;
      }
      .feature-blog .hero-img {
        width: 100%;
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.12);
        margin: 2rem 0;
        display: block;
      }
      .feature-blog .tip {
        background: white;
        border-left: 4px solid #10b981;
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
      }
      .feature-blog .tip strong {
        color: #059669;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }
      .feature-blog .note {
        background: white;
        border-left: 4px solid #f59e0b;
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
        color: #78350f;
      }
      .feature-blog .note a {
        color: #2563eb;
        font-weight: 600;
        text-decoration: none;
      }
      .feature-blog .note a:hover {
        text-decoration: underline;
      }
      .feature-blog details {
        background: white;
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
      }
      .feature-blog summary {
        padding: 1.25rem;
        cursor: pointer;
        font-weight: 600;
        color: #1e40af;
        list-style: none;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: background-color 0.2s;
      }
      .feature-blog summary:hover {
        background-color: #f8faff;
      }
      .feature-blog summary::before {
        content: "‚ñ∂";
        font-size: 0.8em;
        transition: transform 0.3s;
      }
      .feature-blog details[open] summary::before {
        transform: rotate(90deg);
      }
      .feature-blog details p {
        padding: 0 1.25rem 1.25rem 2.75rem;
        margin: 0;
        color: #64748b;
      }
      @media (max-width: 640px) {
        .feature-blog {
          padding: 1.5rem;
          margin: 2rem 0.5rem;
        }
        .feature-blog h3 {
          font-size: 1.75rem;
        }
        .feature-blog h4 {
          font-size: 1.25rem;
        }
        .feature-blog ul,
        .feature-blog ol {
          margin-left: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <header data-include="navbar"></header>
    <div id="ad-top" class="ad-slot"></div>

    <main class="feature">
      <h2>Password Protect</h2>
      <p class="sub">
        Secure your PDF with a password (processing happens entirely in your
        browser). Do not use this tool for illegal or infringing content.
      </p>

      <div class="card feature-enter protect-card">
        <label class="upload-box" id="drop-zone">
          üìÑ Drop your PDF here or click to upload
          <input
            type="file"
            id="file-input"
            accept="application/pdf"
            style="display: none"
          />
        </label>
        <div id="file-info" class="file-info"></div>

        <div class="field">
          <label for="password">Password</label>
          <input type="password" id="password" placeholder="Enter password" />
        </div>
        <div class="field">
          <label for="confirm">Confirm Password</label>
          <input type="password" id="confirm" placeholder="Confirm password" />
        </div>
        <div class="field">
          <label for="output-name">Output filename</label>
          <input
            type="text"
            id="output-name"
            placeholder="e.g., protected"
            value="protected"
          />
        </div>

        <div class="actions">
          <button id="protect-btn" class="primary" disabled>Protect PDF</button>
        </div>
        <div id="status" class="progress"></div>
        <div class="actions">
          <button id="download-btn" class="primary" style="display: none">
            Download Protected PDF
          </button>
        </div>
      </div>
      <div id="ad-content" class="ad-slot"></div>

      <!-- Enhanced Feature Blog Section -->
      <section class="feature-blog" aria-labelledby="protect-guide-title">
        <div class="title-with-logo">
          <img
            src="../assets/images/sflogoPNG.PNG"
            alt="PDF Tools Logo"
            class="brand-logo"
          />
          <h3 id="protect-guide-title">
            Password Protect Your PDFs Secure, Private, and Simple
          </h3>
        </div>

        <p>
          <strong>Need to protect sensitive documents before sharing?üòó</strong>
          The Password Protect tool puts encryption right into your PDF files. It makes sure a password is 
          needed just to open them up. This works great for things like invoices or contracts. It also helps 
          with ID scans and any other papers you need to keep away from prying eyes. Everything gets handled 
          right there in your own browser, no outside processing involved.
        </p>

        <img
          src="../assets/images/protect pdf.JPG"
          alt="Password protect PDF documents"
          class="hero-img"
        />

        <h4>How It Worksü§®</h4>
        <p>
          The Password Protect tool grabs your PDF file and whips up an encrypted version based on the 
          password you enter. Encryption takes place completely inside your browser, relying on those 
          standard PDF security methods. There are no uploads involved, and nothing gets handled on a server.
          The original file remains completely unchanged. You simply download the fresh password-protected copy instead.
        </p>

        <p>
          Imagine securing a document by placing it inside a locked container. The owner chooses a specific 
          combination, which serves as the password. Individuals possessing that exact combination alone can 
          unlock the container and gain entry. Encryption protects the PDF file itself. As a result, the contents 
          stay hidden from view unless the correct password is provided.
        </p>

        <h4>Why Use This Toolüòó</h4>
        <ul>
          <li>
            <strong>Protect confidential documents</strong> - Secure contracts,
            invoices, and financial records
          </li>
          <li>
            <strong>Share sensitive information</strong> - Send ID scans,
            medical records, or personal files safely
          </li>
          <li>
            <strong>Control document access</strong> - Ensure only intended
            recipients can open your PDFs
          </li>
          <li>
            <strong>Email security</strong> - Add an extra layer of protection
            when sending via email
          </li>
          <li>
            <strong>Compliance requirements</strong> - Meet data protection and
            privacy regulations
          </li>
        </ul>

        <h4>Complete Privacyü´°</h4>
        <p>
        Your PDF stays put on your computer. All the password protection and encryption take place right 
        there in your browser, handled by JavaScript. No files ever get uploaded to a server. That setup 
        matters a lot for sensitive items like contracts, medical records, financial statements, or personal 
        identification.
        </p>

        <div class="tip">
          <strong> Your Privacy Matters:</strong><br />
          100% client-side processingüòó - everything stays on your device<br />
          No server uploadsü´° - your document never goes online<br />
          No password storageüòâ - we never see or save your password<br />
          Works offlineü§ó - protect files even without internet connection
        </div>

        <h4>Password Security Tipsüòâ</h4>
        <p>
          Setting a password is only half the battle‚Äîchoosing a
          <em>strong</em> password makes all the difference between real
          security and a false sense of protection. Here's how to do it right:
        </p>
        <ul>
          <li>
            <strong>Length Beats Complexity‚úåÔ∏è:</strong> A password with more than twelve characters turns out 
            to be much tougher for anyone to break compared to one that is just eight characters long even 
            if it includes special symbols. That makes sense because length adds real strength. People 
            should target at least twelve characters in general. For protecting important files like contracts 
            or tax records or medical information, going for sixteen or more characters seems even better.
          </li>
          <li>
            <strong>Create Memorable Passphrasesüòâ:</strong> Combine random words
            with numbers and symbols for passwords that are both secure and
            easier to remember. Something like
            <code>violet-train-lake-47!</code> or
            <code>BlueCoffee$Morning92</code> is way better than
            <code>p@ssw0rd</code>. The randomness makes it hard to guess, but
            the words make it easier for you to recall.
          </li>
          <li>
            <strong>Avoid Common Patternsüòâ:</strong> Avoid using birthdays like 1990 or 0512 when creating passwords. 
            Names such as JohnSmith or CompanyName make poor choices too. Keyboard patterns including qwerty or asdf 
            prove easy to spot. The word password on its own offers no real protection. Hackers target these options 
            right from the start. They manage to break through them in a surprisingly short time.
          </li>
          <li>
            <strong>Share Securelyü´°:</strong> Never put the PDF and its password right there in one single email. Somebody 
            could grab that message along the way. Then they would own the whole deal. Send over the PDF through email instead. 
            Handle the password on a separate path. Think text message or phone call. Or even a secure app works fine. This split 
            method makes security hold up a good deal better.
          </li>
          <li>
            <strong>Keep a Recordüòâ:</strong> It is advisable to store passwords using a dedicated password manager, such as 
            1Password, Bitwarden, or LastPass. Another option involves recording them in a secure physical location. Evidence from   
            digital security practices indicates that forgetting the password for a protected PDF file leads to permanent inaccessibility.
            No reset mechanism exists in such cases. This underscores the importance of reliable storage methods.
          </li>
          <li>
            <strong>Don't Reuse Passwordsüòó:</strong> It is advisable to employ a distinct password for every sensitive document. Should one 
            such password become compromised, the risk extends to avoiding access to all other protected PDFs that might have been generated 
            over time. In this manner, each document functions essentially as its own independent secure repository.
          </li>
        </ul>

        <h4>üîê When to Use Password Protectionü§î</h4>
        <p>
          Not every PDF needs a password, but certain situations absolutely
          demand it. Here's when you should lock down your documents:
        </p>
        <p>
          <strong>Contracts and Agreementsüòó:</strong> If a contract includes sensitive terms, pricing details, or confidential clauses, it makes 
          sense to password protect the file before sending it by email. That step guarantees only the person meant to receive it, the one who 
          knows the password, can actually open the document and go over its contents.
        </p>
        <p>
          <strong>Financial Documentsü§∑‚Äç‚ôÇÔ∏è:</strong> Tax returns need password protection all the time. Bank statements do too. Invoices that list account 
          numbers should get the same treatment. Any document with payment details falls into this category. Financial information draws in crooks looking 
          for identity theft or straight fraud.
        </p>
        <p>
          <strong>Personal Recordsüòâ:</strong> Medical records, legal documents, social security numbers, and passport scans all fall into this category. 
          Anything that might enable identity theft or simply should not become public knowledge requires encryption. A strong password provides the necessary 
          protection for such sensitive materials.
        </p>
        <p>
          <strong>Pro tipü´°:</strong>When folks need to share a password protected PDF with several people at the same time, it seems smart to turn to a shared
          password manager or some kind of secure service for notes. That way the password gets passed around without too much worry. Posting those passwords in 
          public spots like Slack channels or group emails just invites trouble. Places like that often end up indexed or stored in ways that are not really safe.
        </p>

        <h4>Quick Guide</h4>
        <ol>
          <li>
            <strong>Upload your PDF:</strong> Click or drag your file into the
            upload area
          </li>
          <li>
            <strong>Enter password:</strong> Type a strong password (minimum 8
            characters recommended)
          </li>
          <li>
            <strong>Confirm password:</strong> Re-enter the same password to
            verify
          </li>
          <li>
            <strong>Set output name:</strong> Choose a descriptive filename for
            your protected PDF
          </li>
          <li>
            <strong>Protect PDF:</strong> Click the button to encrypt your
            document
          </li>
          <li>
            <strong>Download:</strong> Save your password-protected PDF and
            share securely!
          </li>
        </ol>

        <h4>Frequently Asked Questions</h4>
        <details>
          <summary>Does this change my original file?</summary>
          <p>
          No, the process involves making a fresh encrypted duplicate of the PDF. That means the original file 
          sits unchanged on the device. It stays untouched, just as it always was, without any encryption applied.
          </p>
        </details>

        <details>
          <summary>What happens if I forget the password?</summary>
          <p>
          Thing is, forgetting the password means you cannot open that PDF file at all. The encryption works for real, and there 
          is no simple way to get past it. People should always store their passwords in a safe spot, or just keep an extra copy 
          without any locks on it.
          </p>
        </details>

        <details>
          <summary>Can I remove the password later?</summary>
          <p>
          If someone has the password for a protected PDF. They can easily open it up in any standard PDF reader program. From there, 
          saving or exporting the file creates an unprotected version without much hassle. Another option involves using the unlock tool 
          provided here. That tool handles the password removal directly.
          </p>
        </details>

        <details>
          <summary>Will all PDF readers ask for the password?</summary>
          <p>
          The thing is, any PDF viewer that sticks to the standards will always prompt for the password before it lets a protected file open. 
          This covers common ones like Adobe Reader, web browsers, Preview, and others along those lines. It turns out to be a standard security 
          feature built right into PDFs for protection everywhere.
          </p>
        </details>

        <details>
          <summary>Can I also restrict printing or copying?</summary>
          <p>
          The tool at present handles password protection mainly for opening the document. PDF permission restrictions, such as no-copy or no-print 
          flags, serve only as advisory measures. These can often be bypassed with relative ease. Strong password protection remains the most 
          reliable form of security.
          </p>
        </details>

        <details>
          <summary>How secure is the encryption?</summary>
          <p>
          Standard methods for PDF encryption are employed, drawing on the capabilities provided by pdf-lib. The level of security achieved largely hinges 
          on the quality of the selected password. Evidence indicates that a robust and distinctive password, consisting of at least twelve characters 
          incorporating a variety of types, offers reliable safeguarding in typical scenarios.
          </p>
        </details>

        <div class="note">
          Ready to secure your PDF? Upload your file, set a strong password, and
          download your protected document in seconds.
          <a href="#file-input">Try it now </a>
        </div>
        <h4>Related Tools</h4>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
          "
        >
          <a
            href="./unlock.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Unlock PDF</a
          >
          <a
            href="./watermark.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Add Watermark</a
          >
          <a
            href="./edit.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Edit PDF</a
          >
          <a
            href="./compress.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Compress PDF</a
          >
        </div>
      </section>
    </main>
    <div id="ad-footer" class="ad-slot"></div>
    <div data-include="footer"></div>

    <script>
      const pdfjsLib = window["pdfjs-dist/build/pdf"];
      if (pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
      }

      // Basic runtime checks for required libraries
      function libsReady() {
        const ok = typeof PDFDocument !== "undefined";
        if (!ok) {
          console.error("Libraries not loaded", {
            PDFDocument: typeof PDFDocument,
          });
        }
        return ok;
      }

      // Dynamic loader with multi-CDN fallbacks for PDFKit and blob-stream
      function loadScript(url) {
        return new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = url;
          s.async = true;
          s.crossOrigin = "anonymous";
          s.onload = () => resolve();
          s.onerror = () => reject(new Error("Failed to load " + url));
          document.head.appendChild(s);
        });
      }

      async function ensureEncryptionLibsLoaded() {
        if (libsReady()) return true;
        // Try local vendored copies first
        const localPdfkit = [
          "../vendor/pdfkit.standalone.min.js",
          "../vendor/pdfkit.standalone.js",
        ];
        for (const u of localPdfkit) {
          try {
            await loadScript(u);
            if (typeof PDFDocument !== "undefined") return true;
          } catch (e) {
            /* ignore */
          }
        }
        // Fall back to multiple CDNs
        const pdfkitUrls = [
          "https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.min.js",
          "https://cdn.jsdelivr.net/npm/pdfkit@0.13.0/js/pdfkit.standalone.js",
          "https://unpkg.com/pdfkit@0.13.0/js/pdfkit.standalone.js",
        ];
        for (const u of pdfkitUrls) {
          try {
            await loadScript(u);
            if (typeof PDFDocument !== "undefined") return true;
          } catch (e) {
            console.warn(e.message);
          }
        }
        return libsReady();
      }

      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const fileInfo = document.getElementById("file-info");
      const protectBtn = document.getElementById("protect-btn");
      const statusText = document.getElementById("status");
      const downloadBtn = document.getElementById("download-btn");
      const passwordInput = document.getElementById("password");
      const confirmInput = document.getElementById("confirm");

      let srcBytes = null;
      let outBlob = null;

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });
      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("dragover")
      );
      dropZone.addEventListener("drop", async (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        const f = e.dataTransfer.files[0];
        if (f) await loadFile(f);
      });
      fileInput.addEventListener("click", (e) => e.stopPropagation());
      fileInput.addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (f) await loadFile(f);
        e.target.value = "";
      });

      async function loadFile(f) {
        const sizeMB = (f.size / (1024 * 1024)).toFixed(2);
        fileInfo.textContent = `üìÑ ${f.name} (${sizeMB} MB uploaded)`;
        const buf = await f.arrayBuffer();
        srcBytes = new Uint8Array(buf);
        protectBtn.disabled = false;
        statusText.textContent = "";
        downloadBtn.style.display = "none";
      }

      function getOutputName(defaultBase) {
        const el = document.getElementById("output-name");
        let name =
          (el && el.value ? el.value : "").trim() || defaultBase || "output";
        name = name.replace(/[\\/:*?"<>|]/g, "-");
        if (!/\.pdf$/i.test(name)) name += ".pdf";
        return name;
      }

      async function renderToImages(bytes) {
        // Render PDF to array of canvases (images)
        const pdf = await pdfjsLib.getDocument({ data: bytes }).promise;
        const pages = [];
        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const viewport = page.getViewport({ scale: 2.0 }); // higher quality
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width = Math.floor(viewport.width);
          canvas.height = Math.floor(viewport.height);
          await page.render({ canvasContext: ctx, viewport }).promise;
          pages.push({ canvas, width: canvas.width, height: canvas.height });
        }
        return pages;
      }

      function pxToPt(px) {
        // Assume 96 CSS dpi -> 72pt per inch
        return (px * 72) / 96;
      }

      function buildEncryptedPDF(pages, password) {
        return new Promise((resolve, reject) => {
          try {
            if (!libsReady()) {
              return reject(
                new Error(
                  "PDFKit failed to load. Check network, CSP, or add vendor/pdfkit.standalone.js"
                )
              );
            }
            // Use different owner password to avoid viewers treating it as owner-only perms
            const doc = new PDFDocument({
              autoFirstPage: false,
              userPassword: password,
              ownerPassword: password + "-owner",
              permissions: {
                printing: "highResolution",
                copying: false,
                modifying: false,
              },
            });

            // Collect chunks directly without blob-stream
            const chunks = [];
            doc.on("data", (chunk) => chunks.push(chunk));
            doc.on("error", (e) => reject(e));
            doc.on("end", () => {
              try {
                const blob = new Blob(chunks, { type: "application/pdf" });
                resolve(blob);
              } catch (e) {
                reject(e);
              }
            });

            (async () => {
              for (const pg of pages) {
                // Convert canvas to a JPEG data URL string for browser PDFKit
                const dataUrl = pg.canvas.toDataURL("image/jpeg", 0.9);
                const pageW = pxToPt(pg.width);
                const pageH = pxToPt(pg.height);
                doc.addPage({ size: [pageW, pageH], margin: 0 });
                doc.image(dataUrl, 0, 0, { width: pageW, height: pageH });
              }
              doc.end();
            })();
          } catch (e) {
            reject(e);
          }
        });
      }

      async function verifyEncrypted(blob) {
        try {
          const ab = await blob.arrayBuffer();
          // Decode as ISO-8859-1 to preserve bytes -> string mapping for /Encrypt marker search
          const str = new TextDecoder("iso-8859-1").decode(new Uint8Array(ab));
          // Look for /Encrypt in trailer or xref streams
          return str.indexOf("/Encrypt") !== -1 || str.indexOf("/O ") !== -1;
        } catch {
          return false;
        }
      }

      protectBtn.addEventListener("click", async () => {
        const pwd = (passwordInput.value || "").trim();
        const conf = (confirmInput.value || "").trim();
        if (!pwd) {
          statusText.textContent = "Please enter a password.";
          return;
        }
        if (pwd !== conf) {
          statusText.textContent = "Passwords do not match.";
          return;
        }
        if (!srcBytes) {
          statusText.textContent = "Please upload a PDF first.";
          return;
        }
        protectBtn.disabled = true;
        statusText.textContent = "Loading encryption engine...";
        try {
          const ready = await ensureEncryptionLibsLoaded();
          if (!ready)
            throw new Error(
              "PDFKit or blob-stream failed to load. Check network or CSP."
            );
          statusText.textContent = "Rendering pages...";
          const pages = await renderToImages(srcBytes);
          statusText.textContent = "Encrypting and rebuilding PDF (PDFKit)...";
          outBlob = await buildEncryptedPDF(pages, pwd);
          // Verify encryption flag exists; if not, treat as failure
          const ok = await verifyEncrypted(outBlob);
          if (!ok) {
            throw new Error(
              "Encryption flag missing in output PDF. Your browser environment may not support client-side PDF encryption."
            );
          }
          downloadBtn.style.display = "inline-block";
          statusText.textContent = "Protected PDF is ready.";
        } catch (e) {
          console.error("Protect failed:", e);
          statusText.textContent = `Failed to protect PDF${
            e && e.message ? ": " + e.message : "."
          }`;
        } finally {
          protectBtn.disabled = false;
        }
      });

      downloadBtn.addEventListener("click", () => {
        if (!outBlob) return;
        const url = URL.createObjectURL(outBlob);
        const a = document.createElement("a");
        a.href = url;
        a.download = getOutputName("protected");
        a.click();
        URL.revokeObjectURL(url);
      });

      // "Try it now" link functionality
      document.addEventListener("DOMContentLoaded", function () {
        const tryLinks = document.querySelectorAll('a[href="#file-input"]');
        tryLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            const fileInput = document.getElementById("file-input");
            if (fileInput) {
              fileInput.click();
              setTimeout(() => {
                window.scrollTo({ top: 0, behavior: "smooth" });
              }, 100);
            }
          });
        });
      });
    </script>
    <script src="../assets/app.js"></script>
  </body>
</html>
