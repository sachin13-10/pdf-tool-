<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6553804345739521" crossorigin="anonymous"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-adsense-account" content="ca-pub-6553804345739521" />
    <meta
      name="description"
      content="Edit PDF files online: add text, shapes, signatures, and images. Free browser-based editor with canvas drawing tools  no uploads required."
    />
    <title>Edit PDF (Canvas) - EDITSMYPDF</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/styles.css" />
    <link rel="canonical" href="https://editmypdf.tech/features/edit.html" />
    <link rel="icon" type="image/png" href="../assets/images/sflogoPNG.PNG" />

    <!-- PDF.js and PDF-Lib for render + export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>

    <style>
      * {
        box-sizing: border-box;
      }

      main {
        max-width: 1000px;
        margin: 3rem auto;
        padding: 1rem;
      }
      .feature-card {
        border: 1px solid #eee;
        border-radius: 16px;
        padding: 1rem 1rem 1.25rem;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      }
      .toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        padding: 0.5rem;
        border: 1px solid #eee;
        border-radius: 12px;
        background: #fafafa;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .toolbar .icon-btn {
        width: 36px;
        height: 36px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        padding: 0;
      }
      .toolbar .group {
        display: flex;
        gap: 0.4rem;
        align-items: center;
        flex-wrap: wrap;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin: 0.75rem 0;
        align-items: center;
      }
      .controls input[type="number"],
      .controls select,
      .controls input[type="color"],
      .controls input[type="text"] {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 0.45rem 0.6rem;
      }
      .work-area {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 1rem;
        align-items: flex-start;
      }
      .left {
        min-width: 0;
      }
      .right {
        width: 100%;
      }
      .side-panel {
        border: 1px solid #eee;
        border-radius: 12px;
        background: #fff;
        padding: 12px;
      }
      .canvas-wrap {
        border: 1px solid #eee;
        border-radius: 12px;
        background: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 8px;
        overflow: auto;
        max-height: 70vh;
        -webkit-overflow-scrolling: touch;
        position: relative;
      }
      .floating-controls {
        position: absolute;
        left: 50%;
        bottom: 12px;
        transform: translateX(-50%);
        background: rgba(20, 20, 20, 0.9);
        color: #fff;
        border-radius: 999px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 8px 12px;
        backdrop-filter: saturate(160%) blur(4px);
      }
      .floating-controls button {
        background: transparent;
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.25);
        border-radius: 10px;
        padding: 6px 10px;
      }
      .floating-controls .pill {
        background: #111;
        border: 1px solid rgba(255, 255, 255, 0.25);
        padding: 6px 10px;
        border-radius: 999px;
        font-weight: 600;
      }
      .floating-controls .sep {
        width: 1px;
        height: 18px;
        background: rgba(255, 255, 255, 0.25);
      }
      canvas {
        background: #fff;
        border: 1px solid #ddd;
        border-radius: 8px;
      }
      .page-nav {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin: 0.75rem 0;
      }
      .file-info {
        color: #333;
        font-weight: 500;
        font-size: 0.95rem;
        margin-top: 0.5rem;
      }
      .upload-box {
        min-height: 160px;
      }
      @media (max-width: 900px) {
        .work-area {
          grid-template-columns: 1fr;
        }
        .canvas-wrap {
          max-height: 60vh;
        }
      }

      /* Enhanced Feature Blog Styles */
      .feature-blog {
        max-width: 700px;
        margin: 3rem auto;
        padding: 2rem;
        background: linear-gradient(135deg, #f8faff 0%, #f0f4ff 100%);
        border-left: 5px solid #2563eb;
        border-radius: 16px;
        box-shadow: 0 4px 16px rgba(37, 99, 235, 0.08);
        line-height: 1.7;
      }
      .feature-blog h3 {
        font-size: 2rem;
        color: #1e40af;
        margin-bottom: 1rem;
        font-weight: 700;
        line-height: 1.3;
      }
      .feature-blog h4 {
        font-size: 1.5rem;
        color: #1e40af;
        margin-top: 2rem;
        margin-bottom: 1rem;
        font-weight: 600;
      }
      .feature-blog p {
        color: #475569;
        margin-bottom: 1rem;
      }
      .feature-blog strong {
        color: #1e40af;
        font-weight: 600;
      }
      .feature-blog code {
        background: #e0e7ff;
        color: #3730a3;
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 0.9em;
      }
      .feature-blog ul,
      .feature-blog ol {
        margin: 1rem 0 1.5rem 1.5rem;
        color: #475569;
      }
      .feature-blog li {
        margin-bottom: 0.75rem;
      }
      .feature-blog .hero-img {
        width: 100%;
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.12);
        margin: 2rem 0;
        display: block;
      }
      .feature-blog .tip {
        background: white;
        border-left: 4px solid #10b981;
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.1);
      }
      .feature-blog .tip strong {
        color: #059669;
        display: block;
        margin-bottom: 0.5rem;
        font-size: 1.1rem;
      }
      .feature-blog .note {
        background: white;
        border-left: 4px solid #f59e0b;
        padding: 1.25rem;
        border-radius: 12px;
        margin: 1.5rem 0;
        box-shadow: 0 2px 8px rgba(245, 158, 11, 0.1);
        color: #78350f;
      }
      .feature-blog .note a {
        color: #2563eb;
        font-weight: 600;
        text-decoration: none;
      }
      .feature-blog .note a:hover {
        text-decoration: underline;
      }
      .feature-blog details {
        background: white;
        border-radius: 12px;
        margin-bottom: 1rem;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(37, 99, 235, 0.08);
      }
      .feature-blog summary {
        padding: 1.25rem;
        cursor: pointer;
        font-weight: 600;
        color: #1e40af;
        list-style: none;
        display: flex;
        align-items: center;
        gap: 0.75rem;
        transition: background-color 0.2s;
      }
      .feature-blog summary:hover {
        background-color: #f8faff;
      }
      .feature-blog summary::before {
        content: "‚ñ∂";
        font-size: 0.8em;
        transition: transform 0.3s;
      }
      .feature-blog details[open] summary::before {
        transform: rotate(90deg);
      }
      .feature-blog details p {
        padding: 0 1.25rem 1.25rem 2.75rem;
        margin: 0;
        color: #64748b;
      }
      @media (max-width: 640px) {
        .feature-blog {
          padding: 1.5rem;
          margin: 2rem 0.5rem;
        }
        .feature-blog h3 {
          font-size: 1.75rem;
        }
        .feature-blog h4 {
          font-size: 1.25rem;
        }
        .feature-blog ul,
        .feature-blog ol {
          margin-left: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <header data-include="navbar"></header>
    <div id="ad-top" class="ad-slot"></div>

    <main class="feature">
      <h2>Edit PDF (Canvas)</h2>
      <p class="sub">
        Load a PDF, add text/shapes/highlights/images, reorder pages, and
        download ‚Äî all in your browser.
      </p>

      <div class="feature-card feature-enter">
        <!-- Upload -->
        <label
          class="upload-box"
          id="drop-zone"
          style="
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 1rem;
            display: block;
            text-align: center;
            cursor: pointer;
          "
        >
          üìÑ Drop your PDF here or click to upload
          <input
            type="file"
            id="file-input"
            accept="application/pdf"
            style="display: none"
          />
        </label>
        <div id="file-info" class="file-info"></div>

        <!-- Toolbar -->
        <div class="toolbar" aria-label="Editor toolbar" data-requires-pdf>
          <div class="group">
            <button
              class="btn secondary icon-btn"
              id="tool-select"
              title="Select/Move"
              aria-label="Select"
            >
              <span>üñ±Ô∏è</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-text"
              title="Add Text"
              aria-label="Text"
            >
              <span>üî§</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-rect"
              title="Rectangle"
              aria-label="Rectangle"
            >
              <span>‚ñ≠</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-ellipse"
              title="Ellipse"
              aria-label="Ellipse"
            >
              <span>‚óØ</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-pen"
              title="Pen"
              aria-label="Pen"
            >
              <span>‚úçÔ∏è</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-highlighter"
              title="Highlighter"
              aria-label="Highlighter"
            >
              <span>üñçÔ∏è</span>
            </button>
            <button
              class="btn secondary icon-btn"
              id="tool-image"
              title="Add Image"
              aria-label="Add Image"
            >
              <span>üñºÔ∏è</span>
            </button>
          </div>
          <div class="group">
            <button class="btn secondary" id="page-up" title="Move Page Up">
              ‚¨ÜÔ∏è
            </button>
            <button class="btn secondary" id="page-down" title="Move Page Down">
              ‚¨áÔ∏è
            </button>
            <button class="btn secondary" id="undo" title="Undo last on page">
              ‚Ü© Undo
            </button>
            <button
              class="btn secondary"
              id="clear-page"
              title="Clear edits on page"
            >
              üóëÔ∏è Clear
            </button>
          </div>
        </div>

        <div class="controls" data-requires-pdf>
          <label
            >Font size
            <input
              type="number"
              id="font-size"
              value="16"
              min="6"
              max="72"
              style="width: 80px"
          /></label>
          <label>Color <input type="color" id="color" value="#111111" /></label>
          <label
            >Stroke
            <input
              type="number"
              id="stroke"
              value="2"
              min="1"
              max="20"
              style="width: 80px"
          /></label>
          <label
            >Opacity
            <input
              type="number"
              id="opacity"
              value="1"
              step="0.1"
              min="0.1"
              max="1"
              style="width: 80px"
          /></label>
          <label
            >Highlighter
            <input type="color" id="highlight-color" value="#fff59d"
          /></label>
          <label style="display: none"
            >Zoom
            <input
              type="number"
              id="zoom"
              value="1"
              step="0.1"
              min="0.5"
              max="3"
              style="width: 80px"
          /></label>
        </div>

        <div class="work-area">
          <div class="left" data-requires-pdf>
            <div class="canvas-wrap">
              <canvas
                id="canvas"
                class="page-surface"
                width="600"
                height="800"
              ></canvas>
              <div
                class="floating-controls"
                aria-label="Page controls"
                data-requires-pdf
              >
                <button id="zoom-out" title="Zoom out">‚àí</button>
                <button id="page-prev" title="Previous page">‚óÄ</button>
                <div class="pill"><span id="page-label">Page 0 / 0</span></div>
                <button id="page-next" title="Next page">‚ñ∂</button>
                <button id="zoom-in" title="Zoom in">+</button>
              </div>
            </div>
            <div class="page-nav">
              <span id="status" class="progress"></span>
            </div>
          </div>
          <div class="right" data-requires-pdf>
            <div class="side-panel">
              <label for="output-name">Output filename</label>
              <input
                type="text"
                id="output-name"
                placeholder="e.g., edited"
                value="edited"
              />
              <div
                class="inline-actions"
                style="justify-content: flex-start; margin-top: 0.75rem"
              >
                <button class="btn primary" id="export">Download</button>
                <button class="btn secondary" id="reset-edits">
                  Reset All Edits
                </button>
              </div>
            </div>
            <input
              type="file"
              id="image-input"
              accept="image/*"
              style="display: none"
            />
          </div>
        </div>
      </div>

      <div id="ad-content" class="ad-slot"></div>

      <!-- Enhanced Feature Blog Section -->
      <section class="feature-blog" aria-labelledby="edit-guide-title">
        <div class="title-with-logo">
          <img
            src="../assets/images/sflogoPNG.PNG"
            alt="PDF Tools Logo"
            class="brand-logo"
          />
          <h3 id="edit-guide-title">
            ‚úèÔ∏è Edit PDFs Directly in Your Browser ‚Äî Add Text, Signatures, and
            More
          </h3>
        </div>

        <p>
          <strong
            >Need to add notes, signatures, highlights, or shapes to a
            PDF?ü§ó</strong
          >
          Our Edit tool provides a complete canvas editor that works right 
          inside the browser. Users can add text boxes easily. They draw lines 
          with a pen feature. Important sections get highlighted too. Images or 
          signatures insert without any trouble. None of this involves uploading 
          the file to some external spot. It stays simple and secure that way.
        </p>

        <img
          src="../assets/images/edit pdf - Copy.JPG"
          alt="Edit PDF in browser"
          class="hero-img"
        />

        <h4>?? How It Works</h4>
        <p>
          The edit tool handles your PDF by loading it first. It renders every 
          single page onto an HTML5 canvas for easy work. From there, layers come 
          in with text, drawings, shapes, highlights, and images added right on top. 
          Once the editing wraps up, all those changes merge together into a fresh PDF. 
          This part relies on pdf-lib to make it happen<strong>everything happens locally 
          in your browser</strong>. No servers involved, no file uploads.
        </p>

        <p>
        Imagine putting a clear overlay right on top of your document. You go ahead 
        and add all your notes or changes onto that overlay. Then the process transfers 
        those marks over to a brand new copy of the PDF. The first file remains exactly 
        as it was. You end up with an updated version that is all set for sharing.
        </p>

        <h4>Why Use This Toolü§®</h4>
        <ul>
          <li>
            <strong>Add signaturesü´°</strong> - Upload signature images or draw
            with the pen tool
          </li>
          <li>
            <strong>Insert text annotationsüòâ</strong> - Add comments,
            corrections, or labels anywhere
          </li>
          <li>
            <strong>Highlight key sectionsüëç</strong> - Mark important text with
            customizable colors
          </li>
          <li>
            <strong>Draw shapes and diagrams‚úåÔ∏è</strong> - Add rectangles, circles,
            arrows, and freehand drawings
          </li>
          <li>
            <strong>Insert images and stampsüòâ</strong> - Add logos, watermarks,
            or custom graphics
          </li>
          <li>
            <strong>Reorder pagesüòó</strong> - Move pages up or down to reorganize
            your document
          </li>
        </ul>

        <h4>Complete Privacyü´°</h4>
        <p>
        Your PDF stays right on your own computer. Editing takes place straight in 
        the browser, with JavaScript and HTML5 Canvas handling everything. No files 
        ever get sent up to a server. That matters a lot for papers with signatures 
        or personal details, contracts, and any kind of private business stuff.
        </p>

        <div class="tip">
          <strong> Your Privacy Mattersü´°:</strong><br />
          100% client-side processing - everything stays on your device<br />
          ÔøΩ No server uploads - your document never goes online<br />
          No data storage - nothing is saved or tracked<br />
          Works offline - use it even without internet connection
        </div>

        <h4>Editing Tipsüòâ</h4>
        <p>
        Editing PDFs directly in your browser offers real power for quick changes. 
        A handful of smart techniques can help those edits come across as professional. 
        They avoid that hasty, slapped-on appearance. The key details follow next:
        </p>
        <ul>
          <li>
            <strong>Text Tool for Clean Labelsüòó:</strong> You can click in any spot to add a 
            text box there. Once it is placed, go ahead and type whatever content you want 
            inside it. It helps to adjust the font size for better reading, so something around 
            12 to 16 points usually works well. Match the color to what is already in the document 
            if that fits your needs. One useful suggestion comes up when you add notes or annotations. 
            In those cases, pick a color that contrasts strongly, like red or even blue. Doing so makes 
            those parts pop out clearly against the main original material.
          </li>
          <li>
            <strong>Highlighter Opacity Mattersüòâ:</strong>The default opacity setting for the highlighter 
            often feels a bit too intense. It tends to hide the text beneath it in a way that makes 
            reading harder. Consider lowering that value to somewhere between 0.3 and 0.5. This adjustment 
            creates the familiar transparent effect seen in traditional highlighters. The color remains 
            vivid enough to draw the eye right away. At the same time, the underlying text stays perfectly 
            legible and clear.
          </li>
          <li>
            <strong>Pen Tool for Signatures and Arrowsüòó:</strong> This tool serves as the main option for 
            freehand drawing tasks. People often use it to sign contracts or add arrows that point out 
            important sections in documents. It works well for underlining key phrases and sketching simple 
            diagrams on the fly. For bolder signatures, try increasing the stroke width to around 4 to 6 
            pixels. On the other hand, stick with a thinner line at 2 pixels when you need precise annotations.
          </li>
          <li>
            <strong>Shapes for Professional Callouts‚úåÔ∏è:</strong> Rectangles and ellipses help form sharp, geometric 
            highlights for key sections in documents. They come across as far more refined compared to those
            rough hand-drawn circles people sometimes use. This approach works especially well in professional
            business materials where polish matters. Opt for semi-transparent fills by dialing down the opacity 
            a bit. That way the original content stays clear and readable underneath.
          </li>
          <li>
            <strong>Undo Saves You Timeüëç:</strong> You made a mistake. Or you do not like how something looks. 
            Just hit the undo button. That removes the most recent edit from the current page. It proves much 
            faster than drawing over those mistakes. Or even starting the whole thing from scratch.
          </li>
          <li>
            <strong>Clear Page When You Mess Upüòó:</strong> If a page starts looking too cluttered, or if someone 
            wants to begin over from the beginning, the Clear Page button comes in handy. It clears out every 
            single edit made on that page all at once. The changes do not touch any of the other pages at all. 
            Those stay exactly as they were before. From there, editing can happen again on the cleared page. 
            It starts fresh every time.
          </li>
          <li>
            <strong>Navigate Efficientlyüòâ:</strong> You can use the page controls with arrows or the page number 
            display to jump between pages in a quick way. Edit just one page at a time, then move right on to 
            the next one, and keep that process going. All the changes you make get saved in the memory there 
            until you finally export everything as a PDF.
          </li>
        </ul>

        <h4>üé® Making Your Edits Look Professional</h4>
        <p>
        Lots of folks can just throw text and some basic shapes right onto a PDF. But getting those changes 
        to seem planned out and nicely done calls for extra thought. This covers ways to step up how you 
        handle PDF edits:
        </p>
        <p>
          <strong>Match the Original Styleüòó:</strong> If the PDF sticks to a certain color setup, such as 
          corporate blue or plain black text, you should aim to use matching colors for any annotations you 
          add. Your changes will then blend right into the document. They will not stand out like something 
          tacked on much later.
        </p>
        <p>
          <strong>Consistent Sizingüòâ:</strong> Choose one font size for all your annotations. Keep using that 
          exact size no matter which page you are on. Suppose you go with 14 point red text for a single comment. 
          Make sure every other comment like it gets the same size and color treatment. That kind of steady 
          approach really makes the whole thing look professional. On the other hand, jumping around with 
          different sizes just comes off as sloppy and unorganized.
        </p>
        <p>
          <strong>White Space is Your Friendü§ó:</strong> You should avoid squeezing text or shapes right up against 
          the content that is already there. Giving some space around the changes you make helps keep everything from 
          looking too crowded. It also makes the whole thing easier to read without strain. Placing an annotation in 
          the right spot with room to spare pulls the attention naturally.
        </p>
        <p>
          <strong>Test Before You Exportüòâ:</strong> You should go through every page you have edited. Do that right 
          before you download the final PDF version. Check to see if anything overlaps in an odd way. Make certain 
          all the text comes out clear and easy to read. See that your highlights point to the exact spots they are 
          meant for. Taking a fast look over everything like this. It keeps you from starting the whole process 
          again down the line.
        </p>

        <h4>Quick Guide</h4>
        <ol>
          <li>
            <strong>Upload your PDF:</strong> Drag and drop or click to select
            your file
          </li>
          <li>
            <strong>Choose a tool:</strong> Select text, pen, highlighter,
            shapes, or image from the toolbar
          </li>
          <li>
            <strong>Make your edits:</strong> Click on the canvas to add text,
            draw, or place elements
          </li>
          <li>
            <strong>Customize appearance:</strong> Adjust colors, sizes, stroke
            width, and opacity
          </li>
          <li>
            <strong>Navigate pages:</strong> Use page controls to edit multiple
            pages
          </li>
          <li>
            <strong>Export:</strong> Set an output filename and download your
            edited PDF!
          </li>
        </ol>

        <h4>Frequently Asked Questions</h4>
        <details>
          <summary>Will my original PDF be modified?ü§î</summary>
          <p>
          No, we create a completely new PDF file with the edits applied. 
          The original file remains exactly as it was on the device.
          </p>
        </details>

        <details>
          <summary>Can I add my signature to contracts?ü§®</summary>
          <p>
          Yes. Users have a couple of options for adding a signature. They can upload an image 
          file in PNG or JPG format. The image tool handles that step easily. Another choice is 
          to draw the signature straight onto the PDF itself. The pen tool makes this straightforward 
          too. Either approach serves the purpose well. It allows for quick signing of various documents.
          </p>
        </details>

        <details>
          <summary>What happens to existing text and links?üòó</summary>
          <p>
          The existing content inside any PDF file remains fully preserved. That covers all text, links, 
          images, and even the original formatting without any alterations. Edits then appear as an 
          additional layer placed right on top. This layer integrates directly into the completed PDF 
          document.
          </p>
        </details>

        <details>
          <summary>Can I undo mistakes?ü§î</summary>
          <p>
          Every page includes an undo button designed to remove the most recent edit performed on that 
          specific page. This feature helps users correct mistakes easily. There is also a Clear page 
          button available for the current page. It eliminates all edits made there in a single action.
          </p>
        </details>

        <details>
          <summary>Is there a page limit?ü§®</summary>
          <p>
          The software can handle PDF files regardless of their size. Files that run over a hundred pages 
          or so might need a little extra time to load up at first. Once they are in though, the editing 
          process goes pretty smoothly without hitches. Browser memory ends up being the main thing that 
          could hold it back.
          </p>
        </details>

        <details>
          <summary>Can I reorder pages while editing?</summary>
          <p>
          You can use the page up and down buttons in the toolbar to reorder pages however you like. The 
          final PDF export will reflect that new page order you just set up. This works well for reorganizing 
          documents quickly when you need to adjust things.
          </p>
        </details>

        <div class="note">
          Ready to edit?üòâ Upload your PDF, choose your tools, and create a
          professionally annotated document in minutesü§ó.
          <a href="#file-input">Try it now </a>
        </div>
        <h4>Related Tools</h4>
        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
          "
        >
          <a
            href="./watermark.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Add Watermark</a
          >
          <a
            href="./page-numbers.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
            ># Page Numbers</a
          >
          <a
            href="./protect.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Password Protect</a
          >
          <a
            href="./rotate.html"
            style="
              display: block;
              padding: 0.75rem 1rem;
              background: white;
              border: 1px solid #e0e7ff;
              border-radius: 8px;
              text-decoration: none;
              color: #1e40af;
              font-weight: 500;
              transition: all 0.2s;
            "
          >
            Rotate PDF</a
          >
        </div>
      </section>
    </main>

    <div id="ad-footer" class="ad-slot"></div>
    <div data-include="footer"></div>

    <script>
      if (pdfjsLib && pdfjsLib.GlobalWorkerOptions) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
      }

      const dropZone = document.getElementById("drop-zone");
      const fileInput = document.getElementById("file-input");
      const fileInfo = document.getElementById("file-info");
      const canvas = document.getElementById("canvas");
      const canvasWrap = document.querySelector(".canvas-wrap");
      const ctx = canvas.getContext("2d");
      const statusText = document.getElementById("status");
      const pageLabel = document.getElementById("page-label");

      const toolSelectBtn = document.getElementById("tool-select");
      const toolTextBtn = document.getElementById("tool-text");
      const toolRectBtn = document.getElementById("tool-rect");
      const toolEllipseBtn = document.getElementById("tool-ellipse");
      const toolPenBtn = document.getElementById("tool-pen");
      const toolHighBtn = document.getElementById("tool-highlighter");
      const toolImageBtn = document.getElementById("tool-image");

      const pagePrevBtn = document.getElementById("page-prev");
      const pageNextBtn = document.getElementById("page-next");
      const pageUpBtn = document.getElementById("page-up");
      const pageDownBtn = document.getElementById("page-down");

      const undoBtn = document.getElementById("undo");
      const clearBtn = document.getElementById("clear-page");

      const fontSizeInput = document.getElementById("font-size");
      const colorInput = document.getElementById("color");
      const strokeInput = document.getElementById("stroke");
      const opacityInput = document.getElementById("opacity");
      const highlightColorInput = document.getElementById("highlight-color");
      const zoomInput = document.getElementById("zoom");

      const exportBtn = document.getElementById("export");
      const outputNameInput = document.getElementById("output-name");
      const imageInput = document.getElementById("image-input");

      const requiresPdfEls = Array.from(
        document.querySelectorAll("[data-requires-pdf]")
      );
      requiresPdfEls.forEach((el) => (el.style.display = "none"));

      let pdfData = null; // Uint8Array
      let pdf = null; // pdf.js doc
      let pageCount = 0;
      let currentPage = 1;
      let viewportCache = {}; // pageNumber -> {width,height,scale}
      let pageOrder = []; // [1..n]

      const overlays = new Map(); // pageNumber -> [items]
      // item: {type, x,y,w,h,color, stroke, opacity, text, imgDataUrl, path:[{x,y}], fontSize}
      let activeTool = "select";
      let drawing = false;
      let tempItem = null;
      let autoFit = false;

      function setTool(tool) {
        activeTool = tool;
        statusText.textContent = `Tool: ${tool}`;
      }
      toolSelectBtn.onclick = () => setTool("select");
      toolTextBtn.onclick = () => setTool("text");
      toolRectBtn.onclick = () => setTool("rect");
      toolEllipseBtn.onclick = () => setTool("ellipse");
      toolPenBtn.onclick = () => setTool("pen");
      toolHighBtn.onclick = () => setTool("highlight");
      toolImageBtn.onclick = () => imageInput.click();

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
      });
      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("dragover")
      );
      dropZone.addEventListener("drop", async (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        const f = e.dataTransfer.files[0];
        if (f && f.type === "application/pdf") await loadFile(f);
      });
      fileInput.addEventListener("click", (e) => e.stopPropagation());
      fileInput.addEventListener("change", async (e) => {
        const f = e.target.files[0];
        if (f) await loadFile(f);
        e.target.value = "";
      });

      async function loadFile(file) {
        const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
        fileInfo.textContent = `üìÑ ${file.name} (${sizeMB} MB)`;
        const buf = await file.arrayBuffer();
        pdfData = new Uint8Array(buf);
        pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
        pageCount = pdf.numPages;
        pageOrder = Array.from({ length: pageCount }, (_, i) => i + 1);
        overlays.clear();
        viewportCache = {};
        currentPage = 1;
        requiresPdfEls.forEach((el) => {
          el.style.display = "";
        });
        dropZone.style.display = "none";
        try {
          const first = await pdf.getPage(1);
          const vp1 = first.getViewport({ scale: 1 });
          const containerW =
            canvasWrap && canvasWrap.clientWidth
              ? canvasWrap.clientWidth
              : vp1.width;
          const fitScale = Math.max(0.5, Math.min(3, containerW / vp1.width));
          zoomInput.value = fitScale.toFixed(2);
          autoFit = true;
        } catch (e) {
          autoFit = false;
        }
        await renderPage();
      }

      async function renderPage() {
        if (!pdf) return;
        statusText.textContent = "Rendering...";
        const page = await pdf.getPage(currentPage);
        const zoom = Math.max(
          0.5,
          Math.min(3, parseFloat(zoomInput.value) || 1)
        );
        const viewport = page.getViewport({ scale: zoom });
        canvas.width = Math.floor(viewport.width);
        canvas.height = Math.floor(viewport.height);
        await page.render({ canvasContext: ctx, viewport }).promise;
        viewportCache[currentPage] = {
          width: viewport.width,
          height: viewport.height,
          scale: zoom,
        };
        drawOverlays();
        pageLabel.textContent = `Page ${currentPage} / ${pageCount}`;
        statusText.textContent = "";
      }

      function getPageItems(n) {
        if (!overlays.has(n)) overlays.set(n, []);
        return overlays.get(n);
      }

      function drawOverlays() {
        const items = getPageItems(currentPage);
        for (const it of items) {
          ctx.save();
          ctx.globalAlpha = it.opacity ?? 1;
          ctx.strokeStyle = it.color || "#111";
          ctx.fillStyle =
            it.fillColor ||
            (it.type === "highlight" ? it.color || "#fff59d" : "rgba(0,0,0,0)");
          ctx.lineWidth = it.stroke || 2;
          if (it.type === "text") {
            ctx.fillStyle = it.color || "#111";
            ctx.font = `${it.fontSize || 16}px Helvetica, Arial, sans-serif`;
            ctx.fillText(it.text || "Text", it.x, it.y);
          } else if (it.type === "rect") {
            if (it.fill) ctx.fillRect(it.x, it.y, it.w, it.h);
            ctx.strokeRect(it.x, it.y, it.w, it.h);
          } else if (it.type === "ellipse") {
            ctx.beginPath();
            ctx.ellipse(
              it.x + it.w / 2,
              it.y + it.h / 2,
              Math.abs(it.w / 2),
              Math.abs(it.h / 2),
              0,
              0,
              Math.PI * 2
            );
            if (it.fill) ctx.fill();
            ctx.stroke();
          } else if (it.type === "image" && it.img) {
            ctx.drawImage(it.img, it.x, it.y, it.w, it.h);
          } else if (it.type === "pen" || it.type === "highlight") {
            ctx.strokeStyle =
              it.color || (it.type === "highlight" ? "#fff59d" : "#111");
            ctx.lineWidth = it.stroke || (it.type === "highlight" ? 16 : 2);
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.beginPath();
            const p = it.path || [];
            for (let i = 0; i < p.length; i++) {
              const pt = p[i];
              if (i === 0) ctx.moveTo(pt.x, pt.y);
              else ctx.lineTo(pt.x, pt.y);
            }
            ctx.stroke();
          }
          ctx.restore();
        }
      }

      // Drawing interactions
      canvas.addEventListener("mousedown", (e) => {
        if (!pdf) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const color = colorInput.value;
        const stroke = parseFloat(strokeInput.value) || 2;
        const opacity = Math.max(
          0.1,
          Math.min(1, parseFloat(opacityInput.value) || 1)
        );
        if (activeTool === "text") {
          const text = prompt("Enter text");
          if (text) {
            getPageItems(currentPage).push({
              type: "text",
              x,
              y,
              text,
              color,
              opacity,
              fontSize: parseInt(fontSizeInput.value || "16", 10) || 16,
            });
            drawOverlays();
          }
          return;
        }
        if (activeTool === "rect" || activeTool === "ellipse") {
          tempItem = {
            type: activeTool,
            x,
            y,
            w: 0,
            h: 0,
            color,
            stroke,
            opacity,
            fill: true,
            fillColor: color + "88",
          };
          drawing = true;
          return;
        }
        if (activeTool === "pen" || activeTool === "highlight") {
          tempItem = {
            type: activeTool,
            path: [{ x, y }],
            color:
              activeTool === "highlight" ? highlightColorInput.value : color,
            stroke:
              activeTool === "highlight"
                ? parseFloat(strokeInput.value) || 16
                : stroke,
            opacity: activeTool === "highlight" ? 0.5 : opacity,
          };
          drawing = true;
          return;
        }
      });
      canvas.addEventListener("mousemove", (e) => {
        if (!drawing || !tempItem) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        if (tempItem.type === "rect" || tempItem.type === "ellipse") {
          tempItem.w = x - tempItem.x;
          tempItem.h = y - tempItem.y;
          renderPage();
          ctx.save();
          ctx.globalAlpha = tempItem.opacity || 1;
          ctx.strokeStyle = tempItem.color;
          ctx.fillStyle = tempItem.fillColor || "rgba(0,0,0,0)";
          ctx.lineWidth = tempItem.stroke || 2;
          if (tempItem.type === "rect") {
            if (tempItem.fill)
              ctx.fillRect(tempItem.x, tempItem.y, tempItem.w, tempItem.h);
            ctx.strokeRect(tempItem.x, tempItem.y, tempItem.w, tempItem.h);
          } else {
            ctx.beginPath();
            ctx.ellipse(
              tempItem.x + tempItem.w / 2,
              tempItem.y + tempItem.h / 2,
              Math.abs(tempItem.w / 2),
              Math.abs(tempItem.h / 2),
              0,
              0,
              Math.PI * 2
            );
            if (tempItem.fill) ctx.fill();
            ctx.stroke();
          }
          ctx.restore();
          return;
        }
        if (tempItem.type === "pen" || tempItem.type === "highlight") {
          tempItem.path.push({ x, y });
          const p = tempItem.path;
          const n = p.length;
          if (n > 1) {
            ctx.save();
            ctx.globalAlpha = tempItem.opacity || 1;
            ctx.strokeStyle = tempItem.color;
            ctx.lineWidth = tempItem.stroke || 2;
            ctx.lineCap = "round";
            ctx.lineJoin = "round";
            ctx.beginPath();
            ctx.moveTo(p[n - 2].x, p[n - 2].y);
            ctx.lineTo(p[n - 1].x, p[n - 1].y);
            ctx.stroke();
            ctx.restore();
          }
        }
      });
      canvas.addEventListener("mouseup", () => {
        if (!drawing) {
          tempItem = null;
          return;
        }
        drawing = false;
        if (tempItem) {
          getPageItems(currentPage).push(tempItem);
          tempItem = null;
        }
      });
      canvas.addEventListener("mouseleave", () => {
        if (drawing) {
          drawing = false;
          if (tempItem) {
            getPageItems(currentPage).push(tempItem);
            tempItem = null;
          }
        }
      });

      imageInput.addEventListener("change", async (e) => {
        const f = e.target.files && e.target.files[0];
        if (!f) return;
        e.target.value = "";
        const reader = new FileReader();
        reader.onload = () => {
          const img = new Image();
          img.onload = () => {
            const w = Math.min(canvas.width * 0.5, img.width);
            const h = w * (img.height / img.width);
            getPageItems(currentPage).push({
              type: "image",
              img,
              imgDataUrl: reader.result,
              x: (canvas.width - w) / 2,
              y: (canvas.height - h) / 2,
              w,
              h,
              opacity: 1,
            });
            renderPage();
          };
          img.src = reader.result;
        };
        reader.readAsDataURL(f);
      });

      document.getElementById("page-prev").onclick = async () => {
        if (!pdf) return;
        currentPage = Math.max(1, currentPage - 1);
        await renderPage();
      };
      document.getElementById("page-next").onclick = async () => {
        if (!pdf) return;
        currentPage = Math.min(pageCount, currentPage + 1);
        await renderPage();
      };
      zoomInput.addEventListener("change", () => {
        autoFit = false;
        renderPage();
      });
      document.getElementById("zoom-in").addEventListener("click", () => {
        const z = Math.min(3, (parseFloat(zoomInput.value) || 1) + 0.1);
        zoomInput.value = z.toFixed(2);
        autoFit = false;
        renderPage();
      });
      document.getElementById("zoom-out").addEventListener("click", () => {
        const z = Math.max(0.5, (parseFloat(zoomInput.value) || 1) - 0.1);
        zoomInput.value = z.toFixed(2);
        autoFit = false;
        renderPage();
      });

      window.addEventListener("resize", async () => {
        if (!pdf) return;
        if (autoFit) {
          try {
            const pg = await pdf.getPage(currentPage);
            const vp = pg.getViewport({ scale: 1 });
            const containerW =
              canvasWrap && canvasWrap.clientWidth
                ? canvasWrap.clientWidth
                : vp.width;
            const fitScale = Math.max(0.5, Math.min(3, containerW / vp.width));
            zoomInput.value = fitScale.toFixed(2);
          } catch (e) {}
        }
        renderPage();
      });

      pageUpBtn.onclick = () => {
        if (!pdf) return;
        const idx = pageOrder.indexOf(currentPage);
        if (idx > 0) {
          [pageOrder[idx - 1], pageOrder[idx]] = [
            pageOrder[idx],
            pageOrder[idx - 1],
          ];
          statusText.textContent = `Moved page ${currentPage} up`;
        }
      };
      pageDownBtn.onclick = () => {
        if (!pdf) return;
        const idx = pageOrder.indexOf(currentPage);
        if (idx >= 0 && idx < pageOrder.length - 1) {
          [pageOrder[idx + 1], pageOrder[idx]] = [
            pageOrder[idx],
            pageOrder[idx + 1],
          ];
          statusText.textContent = `Moved page ${currentPage} down`;
        }
      };

      undoBtn.onclick = () => {
        const items = getPageItems(currentPage);
        items.pop();
        renderPage();
      };
      clearBtn.onclick = () => {
        overlays.set(currentPage, []);
        renderPage();
      };

      function getOutputName(def) {
        let name = (outputNameInput.value || "").trim() || def || "edited";
        name = name.replace(/[\\/:*?"<>|]/g, "-");
        if (!/\.pdf$/i.test(name)) name += ".pdf";
        return name;
      }

      exportBtn.onclick = async () => {
        if (!pdfData) return;
        statusText.textContent = "Exporting...";
        try {
          const srcDoc = await PDFLib.PDFDocument.load(pdfData, {
            ignoreEncryption: true,
          });
          const outDoc = await PDFLib.PDFDocument.create();
          const helv = await outDoc.embedFont(PDFLib.StandardFonts.Helvetica);
          for (let oi = 0; oi < pageOrder.length; oi++) {
            const pageNum = pageOrder[oi];
            const [copied] = await outDoc.copyPages(srcDoc, [pageNum - 1]);
            const page = copied;
            outDoc.addPage(page);
            const pageWidth = page.getWidth();
            const pageHeight = page.getHeight();
            const items = overlays.get(pageNum) || [];
            const vp = viewportCache[pageNum];
            const pxToPt = vp ? pageWidth / vp.width : 1;
            for (const it of items) {
              const color = it.color || "#111";
              const rgb = hexToRgb(color) || { r: 0, g: 0, b: 0 };
              const options = {
                opacity: it.opacity ?? 1,
                color: PDFLib.rgb(rgb.r / 255, rgb.g / 255, rgb.b / 255),
              };
              if (it.type === "text") {
                const x = it.x * pxToPt;
                const y = pageHeight - it.y * pxToPt;
                page.drawText(it.text || "Text", {
                  x,
                  y,
                  size: it.fontSize || 16,
                  font: helv,
                  color: options.color,
                  opacity: options.opacity,
                });
              } else if (it.type === "rect") {
                const x = it.x * pxToPt;
                const y = pageHeight - (it.y + it.h) * pxToPt;
                const w = it.w * pxToPt;
                const h = it.h * pxToPt;
                page.drawRectangle({
                  x,
                  y,
                  width: w,
                  height: h,
                  borderWidth: it.stroke || 2,
                  color: options.color,
                  borderColor: options.color,
                  opacity: options.opacity,
                  fillOpacity: it.fill ? options.opacity : 0,
                });
              } else if (it.type === "ellipse") {
                const x = it.x * pxToPt;
                const y = pageHeight - (it.y + it.h) * pxToPt;
                const w = Math.abs(it.w * pxToPt);
                const h = Math.abs(it.h * pxToPt);
                page.drawEllipse({
                  x: x + w / 2,
                  y: y + h / 2,
                  xScale: w / 2,
                  yScale: h / 2,
                  borderWidth: it.stroke || 2,
                  color: options.color,
                  borderColor: options.color,
                  opacity: options.opacity,
                  fillOpacity: it.fill ? options.opacity : 0,
                });
              } else if (it.type === "image" && it.imgDataUrl) {
                const embed = it.imgDataUrl.startsWith("data:image/png")
                  ? await outDoc.embedPng(it.imgDataUrl)
                  : await outDoc.embedJpg(it.imgDataUrl);
                const x = it.x * pxToPt;
                const y = pageHeight - (it.y + it.h) * pxToPt;
                const w = it.w * pxToPt;
                const h = it.h * pxToPt;
                page.drawImage(embed, {
                  x,
                  y,
                  width: w,
                  height: h,
                  opacity: options.opacity,
                });
              } else if (it.type === "pen" || it.type === "highlight") {
                const path = (it.path || [])
                  .map(
                    (p, i) =>
                      `${i === 0 ? "M" : "L"} ${(p.x * pxToPt).toFixed(2)} ${(
                        pageHeight -
                        p.y * pxToPt
                      ).toFixed(2)}`
                  )
                  .join(" ");
                const rgbH = hexToRgb(
                  it.color || (it.type === "highlight" ? "#fff59d" : "#111")
                ) || { r: 255, g: 245, b: 157 };
                page.drawSvgPath(path, {
                  color: PDFLib.rgb(rgbH.r / 255, rgbH.g / 255, rgbH.b / 255),
                  opacity: it.opacity ?? (it.type === "highlight" ? 0.5 : 1),
                  borderWidth: it.stroke || (it.type === "highlight" ? 16 : 2),
                });
              }
            }
          }
          const outBytes = await outDoc.save();
          const blob = new Blob([outBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = getOutputName("edited");
          a.click();
          URL.revokeObjectURL(url);
          statusText.textContent = "Export complete";
        } catch (err) {
          console.error(err);
          statusText.textContent = "Failed to export PDF.";
        }
      };

      function hexToRgb(hex) {
        const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return m
          ? {
              r: parseInt(m[1], 16),
              g: parseInt(m[2], 16),
              b: parseInt(m[3], 16),
            }
          : null;
      }

      // "Try it now" link functionality
      document.addEventListener("DOMContentLoaded", function () {
        const tryNowLinks = document.querySelectorAll('a[href="#file-input"]');
        tryNowLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();
            fileInput.click();
            setTimeout(() => {
              dropZone.scrollIntoView({ behavior: "smooth", block: "center" });
            }, 100);
          });
        });
      });
    </script>
    <script src="../assets/app.js"></script>
  </body>
</html>
